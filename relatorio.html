<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RelatÃ³rio - ChangeMap</title>
  <style>
    /* Estilo completo inserido aqui (omitido nesta resposta por limite de espaÃ§o) */
    /* Copiar e colar o style que vocÃª forneceu anteriormente */
  </style>
</head>
<body>
  <div class="main-container">
    <h2>Resultado da ComparaÃ§Ã£o</h2>
    <h4>Dispositivos com alteraÃ§Ãµes na rede</h4>

    <div class="loading-overlay" id="carregando">
      <div class="loading-container">
        <div class="loading-text">Analisando dispositivos e gerando relatÃ³rio...</div>
        <div class="progress-container">
          <div class="progress-bar" id="barraProgresso"></div>
          <div class="tech-indicators">
            <div class="tech-indicator"></div>
            <div class="tech-indicator"></div>
            <div class="tech-indicator"></div>
            <div class="tech-indicator"></div>
            <div class="tech-indicator"></div>
          </div>
        </div>
        <div class="progress-percentage" id="percentual">0%</div>
        <div class="loading-message">Por favor, aguarde enquanto os dados sÃ£o carregados...</div>
        <div class="data-stream"><div class="data-text">010101001011001101010101101010100110100101010010010101011...</div></div>
      </div>
    </div>

    <div class="status-summary" id="statusBoxes"></div>

    <table>
      <thead>
        <tr>
          <th>Serial</th>
          <th>Hostname</th>
          <th>IP</th>
          <th>Status</th>
          <th>DescriÃ§Ã£o</th>
        </tr>
      </thead>
      <tbody id="tabelaRelatorio"></tbody>
    </table>
  </div>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwAe5PZ7CmpGja8VqpR6IuIK3mCCryG9IDpKry8npQnjmC4LA_9qUBuC_u-G-uv6tRw/exec?view=relatorio-json";
    let progresso = 0;
    const barra = document.getElementById("barraProgresso");
    const percentual = document.getElementById("percentual");

    const simularProgresso = setInterval(() => {
      if (progresso < 95) {
        progresso += Math.random() * 5;
        barra.style.width = `${progresso}%`;
        percentual.textContent = `${Math.floor(progresso)}%`;
      } else {
        clearInterval(simularProgresso);
      }
    }, 300);

    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        clearInterval(simularProgresso);
        barra.style.width = `100%`;
        percentual.textContent = `100%`;
        document.getElementById("carregando").style.display = "none";

        const tabela = document.getElementById("tabelaRelatorio");
        const statusBoxes = {
          "Novo Dispositivo": 0,
          "Alterado": 0,
          "Dispositivo Removido": 0,
          "SubstituÃ­do": 0
        };

        data.forEach(row => {
          const tr = document.createElement("tr");
          const statusRaw = (row["Status"] || "").normalize("NFD").replace(/\p{Diacritic}/gu, "").toLowerCase();
          let classe = "", icone = "";

          if (statusRaw.includes("novo")) {
            classe = "status-novo"; icone = "ðŸŸ¢"; statusBoxes["Novo Dispositivo"]++;
          } else if (statusRaw.includes("alterado")) {
            classe = "status-alterado"; icone = "ðŸŸ "; statusBoxes["Alterado"]++;
          } else if (statusRaw.includes("removido")) {
            classe = "status-removido"; icone = "ðŸ”´"; statusBoxes["Dispositivo Removido"]++;
          } else if (statusRaw.includes("substituido")) {
            classe = "status-substituido"; icone = "ðŸŸ£"; statusBoxes["SubstituÃ­do"]++;
          }

          tr.innerHTML = `
            <td>${row["Serial Number"] || ""}</td>
            <td>${row["Hostname"] || ""}</td>
            <td>${row["IP"] || ""}</td>
            <td class="status ${classe}">${icone} ${row["Status"] || ""}</td>
            <td>${row["DescriÃ§Ã£o da AlteraÃ§Ã£o"] || ""}</td>
          `;
          tabela.appendChild(tr);
        });

        const boxContainer = document.getElementById("statusBoxes");
        boxContainer.innerHTML = `
          <span><span class="status-icon">ðŸŸ¢</span> Novos: ${statusBoxes["Novo Dispositivo"]}</span>
          <span><span class="status-icon">ðŸŸ </span> Alterados: ${statusBoxes["Alterado"]}</span>
          <span><span class="status-icon">ðŸ”´</span> Removidos: ${statusBoxes["Dispositivo Removido"]}</span>
          <span><span class="status-icon">ðŸŸ£</span> SubstituÃ­dos: ${statusBoxes["SubstituÃ­do"]}</span>
        `;
      });
  </script>
</body>
</html>
